---
source: crates/tapir-script/compiler/src/compile/ir/optimisations.rs
expression: output
input_file: crates/tapir-script/compiler/src/compile/ir/snapshot_tests/optimisations/integration/recursive_factorial.tapir
---
----------- before -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.19 = int 10
temp.20 = factorial(temp.19)
temp.21 = temp.20
storeprop temp.21, 0
return 

=======================
fn factorial(x.1) -> int

---- block 3 ----
temp.22 = x.1
temp.23 = int 0
temp.24 = temp.22 == temp.23
conditional_jump temp.24 0 1

---- block 0 ----
temp.25 = int 1
return temp.25

---- block 1 ----
jmp 2

---- block 2 ----
temp.26 = x.1
temp.27 = int 1
temp.28 = temp.26 == temp.27
conditional_jump temp.28 5 6

---- block 5 ----
temp.29 = int 1
return temp.29

---- block 6 ----
jmp 7

---- block 7 ----
temp.30 = x.1
temp.31 = x.1
temp.32 = int 1
temp.33 = temp.31 - temp.32
temp.34 = factorial(temp.33)
temp.35 = temp.30 * temp.34
return temp.35


----------- simplify_blocks -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.19 = int 10
temp.20 = factorial(temp.19)
temp.21 = temp.20
storeprop temp.21, 0
return 

=======================
fn factorial(x.1) -> int

---- block 3 ----
temp.22 = x.1
temp.23 = int 0
temp.24 = temp.22 == temp.23
conditional_jump temp.24 0 1

---- block 0 ----
temp.25 = int 1
return temp.25

---- block 1 ----
temp.26 = x.1
temp.27 = int 1
temp.28 = temp.26 == temp.27
jmp 2

---- block 2 ----
conditional_jump temp.28 5 6

---- block 5 ----
temp.29 = int 1
return temp.29

---- block 6 ----
temp.30 = x.1
temp.31 = x.1
temp.32 = int 1
temp.33 = temp.31 - temp.32
temp.34 = factorial(temp.33)
temp.35 = temp.30 * temp.34
jmp 7

---- block 7 ----
return temp.35


----------- copy_propagation -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.19 = int 10
temp.20 = factorial(temp.19)
temp.21 = temp.20
storeprop temp.20, 0
return 

=======================
fn factorial(x.1) -> int

---- block 3 ----
temp.22 = x.1
temp.23 = int 0
temp.24 = x.1 == temp.23
conditional_jump temp.24 0 1

---- block 0 ----
temp.25 = int 1
return temp.25

---- block 1 ----
temp.26 = x.1
temp.27 = int 1
temp.28 = x.1 == temp.27
jmp 2

---- block 2 ----
conditional_jump temp.28 5 6

---- block 5 ----
temp.29 = int 1
return temp.29

---- block 6 ----
temp.30 = x.1
temp.31 = x.1
temp.32 = int 1
temp.33 = x.1 - temp.32
temp.34 = factorial(temp.33)
temp.35 = x.1 * temp.34
jmp 7

---- block 7 ----
return temp.35


----------- dead_store_elimination -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.19 = int 10
temp.20 = factorial(temp.19)
storeprop temp.20, 0
return 

=======================
fn factorial(x.1) -> int

---- block 3 ----
temp.23 = int 0
temp.24 = x.1 == temp.23
conditional_jump temp.24 0 1

---- block 0 ----
temp.25 = int 1
return temp.25

---- block 1 ----
temp.27 = int 1
temp.28 = x.1 == temp.27
jmp 2

---- block 2 ----
conditional_jump temp.28 5 6

---- block 5 ----
temp.29 = int 1
return temp.29

---- block 6 ----
temp.32 = int 1
temp.33 = x.1 - temp.32
temp.34 = factorial(temp.33)
temp.35 = x.1 * temp.34
jmp 7

---- block 7 ----
return temp.35


----------- empty_block -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.19 = int 10
temp.20 = factorial(temp.19)
storeprop temp.20, 0
return 

=======================
fn factorial(x.1) -> int

---- block 3 ----
temp.23 = int 0
temp.24 = x.1 == temp.23
conditional_jump temp.24 0 1

---- block 0 ----
temp.25 = int 1
return temp.25

---- block 1 ----
temp.27 = int 1
temp.28 = x.1 == temp.27
conditional_jump temp.28 5 6

---- block 5 ----
temp.29 = int 1
return temp.29

---- block 6 ----
temp.32 = int 1
temp.33 = x.1 - temp.32
temp.34 = factorial(temp.33)
temp.35 = x.1 * temp.34
return temp.35
