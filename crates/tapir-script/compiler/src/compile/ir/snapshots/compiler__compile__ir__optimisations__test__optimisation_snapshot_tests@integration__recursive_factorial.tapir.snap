---
source: crates/tapir-script/compiler/src/compile/ir/optimisations.rs
expression: output
input_file: crates/tapir-script/compiler/src/compile/ir/snapshot_tests/optimisations/integration/recursive_factorial.tapir
---
----------- before -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.20 = int 10
temp.21 = factorial(temp.20)
temp.22 = temp.21
storeprop temp.22, 0
return 

=======================
fn factorial(x.2) -> int

---- block 3 ----
temp.23 = x.2
temp.24 = int 0
temp.25 = temp.23 == temp.24
conditional_jump temp.25 0 1

---- block 0 ----
temp.26 = int 1
return temp.26

---- block 1 ----
jmp 2

---- block 2 ----
temp.27 = x.2
temp.28 = int 1
temp.29 = temp.27 == temp.28
conditional_jump temp.29 5 6

---- block 5 ----
temp.30 = int 1
return temp.30

---- block 6 ----
jmp 7

---- block 7 ----
temp.31 = x.2
temp.32 = x.2
temp.33 = int 1
temp.34 = temp.32 - temp.33
temp.35 = factorial(temp.34)
temp.36 = temp.31 * temp.35
return temp.36


----------- simplify_blocks -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.20 = int 10
temp.21 = factorial(temp.20)
temp.22 = temp.21
storeprop temp.22, 0
return 

=======================
fn factorial(x.2) -> int

---- block 3 ----
temp.23 = x.2
temp.24 = int 0
temp.25 = temp.23 == temp.24
conditional_jump temp.25 0 1

---- block 0 ----
temp.26 = int 1
return temp.26

---- block 1 ----
temp.27 = x.2
temp.28 = int 1
temp.29 = temp.27 == temp.28
jmp 2

---- block 2 ----
conditional_jump temp.29 5 6

---- block 5 ----
temp.30 = int 1
return temp.30

---- block 6 ----
temp.31 = x.2
temp.32 = x.2
temp.33 = int 1
temp.34 = temp.32 - temp.33
temp.35 = factorial(temp.34)
temp.36 = temp.31 * temp.35
jmp 7

---- block 7 ----
return temp.36


----------- copy_propagation -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.20 = int 10
temp.21 = factorial(temp.20)
temp.22 = temp.21
storeprop temp.21, 0
return 

=======================
fn factorial(x.2) -> int

---- block 3 ----
temp.23 = x.2
temp.24 = int 0
temp.25 = x.2 == temp.24
conditional_jump temp.25 0 1

---- block 0 ----
temp.26 = int 1
return temp.26

---- block 1 ----
temp.27 = x.2
temp.28 = int 1
temp.29 = x.2 == temp.28
jmp 2

---- block 2 ----
conditional_jump temp.29 5 6

---- block 5 ----
temp.30 = int 1
return temp.30

---- block 6 ----
temp.31 = x.2
temp.32 = x.2
temp.33 = int 1
temp.34 = x.2 - temp.33
temp.35 = factorial(temp.34)
temp.36 = x.2 * temp.35
jmp 7

---- block 7 ----
return temp.36


----------- dead_store_elimination -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.20 = int 10
temp.21 = factorial(temp.20)
storeprop temp.21, 0
return 

=======================
fn factorial(x.2) -> int

---- block 3 ----
temp.24 = int 0
temp.25 = x.2 == temp.24
conditional_jump temp.25 0 1

---- block 0 ----
temp.26 = int 1
return temp.26

---- block 1 ----
temp.28 = int 1
temp.29 = x.2 == temp.28
jmp 2

---- block 2 ----
conditional_jump temp.29 5 6

---- block 5 ----
temp.30 = int 1
return temp.30

---- block 6 ----
temp.33 = int 1
temp.34 = x.2 - temp.33
temp.35 = factorial(temp.34)
temp.36 = x.2 * temp.35
jmp 7

---- block 7 ----
return temp.36


----------- empty_block -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.20 = int 10
temp.21 = factorial(temp.20)
storeprop temp.21, 0
return 

=======================
fn factorial(x.2) -> int

---- block 3 ----
temp.24 = int 0
temp.25 = x.2 == temp.24
conditional_jump temp.25 0 1

---- block 0 ----
temp.26 = int 1
return temp.26

---- block 1 ----
temp.28 = int 1
temp.29 = x.2 == temp.28
conditional_jump temp.29 5 6

---- block 5 ----
temp.30 = int 1
return temp.30

---- block 6 ----
temp.33 = int 1
temp.34 = x.2 - temp.33
temp.35 = factorial(temp.34)
temp.36 = x.2 * temp.35
return temp.36
