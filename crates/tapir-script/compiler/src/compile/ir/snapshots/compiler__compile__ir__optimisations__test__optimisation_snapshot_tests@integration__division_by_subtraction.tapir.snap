---
source: crates/tapir-script/compiler/src/compile/ir/optimisations.rs
expression: output
input_file: crates/tapir-script/compiler/src/compile/ir/snapshot_tests/optimisations/integration/division_by_subtraction.tapir
---
----------- before -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.21 = int 100
getprop temp.22, 0
temp.23 = divide(temp.21, temp.22)
temp.24 = temp.23
storeprop temp.24, 0
return 

=======================
fn divide(n.1, d.2) -> int

---- block 2 ----
temp.25 = n.1
r.26 = temp.25
temp.27 = int 0
q.28 = temp.27
jmp 0

---- block 0 ----
r.29 = φ(r.26 from 2, r.39 from 5)
d.31 = φ(d.2 from 2, d.31 from 5)
q.34 = φ(q.28 from 2, q.43 from 5)
temp.30 = r.29
temp.32 = d.31
temp.33 = temp.30 < temp.32
conditional_jump temp.33 3 4

---- block 3 ----
temp.35 = q.34
return temp.35

---- block 4 ----
jmp 5

---- block 5 ----
temp.36 = r.29
temp.37 = d.31
temp.38 = temp.36 - temp.37
r.39 = temp.38
temp.40 = q.34
temp.41 = int 1
temp.42 = temp.40 + temp.41
q.43 = temp.42
jmp 0


----------- empty_phi -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.21 = int 100
getprop temp.22, 0
temp.23 = divide(temp.21, temp.22)
temp.24 = temp.23
storeprop temp.24, 0
return 

=======================
fn divide(n.1, d.2) -> int

---- block 2 ----
temp.25 = n.1
r.26 = temp.25
temp.27 = int 0
q.28 = temp.27
jmp 0

---- block 0 ----
r.29 = φ(r.26 from 2, r.39 from 5)
q.34 = φ(q.28 from 2, q.43 from 5)
temp.30 = r.29
temp.32 = d.2
temp.33 = temp.30 < temp.32
conditional_jump temp.33 3 4

---- block 3 ----
temp.35 = q.34
return temp.35

---- block 4 ----
jmp 5

---- block 5 ----
temp.36 = r.29
temp.37 = d.2
temp.38 = temp.36 - temp.37
r.39 = temp.38
temp.40 = q.34
temp.41 = int 1
temp.42 = temp.40 + temp.41
q.43 = temp.42
jmp 0


----------- simplify_blocks -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.21 = int 100
getprop temp.22, 0
temp.23 = divide(temp.21, temp.22)
temp.24 = temp.23
storeprop temp.24, 0
return 

=======================
fn divide(n.1, d.2) -> int

---- block 2 ----
temp.25 = n.1
r.26 = temp.25
temp.27 = int 0
q.28 = temp.27
jmp 0

---- block 0 ----
r.29 = φ(r.26 from 2, r.39 from 5)
q.34 = φ(q.28 from 2, q.43 from 5)
temp.30 = r.29
temp.32 = d.2
temp.33 = temp.30 < temp.32
conditional_jump temp.33 3 4

---- block 3 ----
temp.35 = q.34
return temp.35

---- block 4 ----
temp.36 = r.29
temp.37 = d.2
temp.38 = temp.36 - temp.37
r.39 = temp.38
temp.40 = q.34
temp.41 = int 1
temp.42 = temp.40 + temp.41
q.43 = temp.42
jmp 5

---- block 5 ----
jmp 0


----------- copy_propagation -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.21 = int 100
getprop temp.22, 0
temp.23 = divide(temp.21, temp.22)
temp.24 = temp.23
storeprop temp.23, 0
return 

=======================
fn divide(n.1, d.2) -> int

---- block 2 ----
temp.25 = n.1
r.26 = n.1
temp.27 = int 0
q.28 = temp.27
jmp 0

---- block 0 ----
r.29 = φ(n.1 from 2, r.39 from 5)
q.34 = φ(temp.27 from 2, q.43 from 5)
temp.30 = r.29
temp.32 = d.2
temp.33 = r.29 < d.2
conditional_jump temp.33 3 4

---- block 3 ----
temp.35 = q.34
return q.34

---- block 4 ----
temp.36 = r.29
temp.37 = d.2
temp.38 = r.29 - d.2
r.39 = temp.38
temp.40 = q.34
temp.41 = int 1
temp.42 = q.34 + temp.41
q.43 = temp.42
jmp 5

---- block 5 ----
jmp 0


----------- dead_store_elimination -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.21 = int 100
getprop temp.22, 0
temp.23 = divide(temp.21, temp.22)
storeprop temp.23, 0
return 

=======================
fn divide(n.1, d.2) -> int

---- block 2 ----
temp.27 = int 0
jmp 0

---- block 0 ----
r.29 = φ(n.1 from 2, r.39 from 5)
q.34 = φ(temp.27 from 2, q.43 from 5)
temp.33 = r.29 < d.2
conditional_jump temp.33 3 4

---- block 3 ----
return q.34

---- block 4 ----
temp.38 = r.29 - d.2
r.39 = temp.38
temp.41 = int 1
temp.42 = q.34 + temp.41
q.43 = temp.42
jmp 5

---- block 5 ----
jmp 0


----------- empty_block -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.21 = int 100
getprop temp.22, 0
temp.23 = divide(temp.21, temp.22)
storeprop temp.23, 0
return 

=======================
fn divide(n.1, d.2) -> int

---- block 2 ----
temp.27 = int 0
jmp 0

---- block 0 ----
r.29 = φ(n.1 from 2, r.39 from 5, r.39 from 4)
q.34 = φ(temp.27 from 2, q.43 from 5, q.43 from 4)
temp.33 = r.29 < d.2
conditional_jump temp.33 3 4

---- block 3 ----
return q.34

---- block 4 ----
temp.38 = r.29 - d.2
r.39 = temp.38
temp.41 = int 1
temp.42 = q.34 + temp.41
q.43 = temp.42
jmp 0


----------- inline_small_functions -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.21 = int 100
getprop temp.22, 0
jmp 2

---- block 2 ----
temp.45 = int 0
jmp 3

---- block 3 ----
r.48 = φ(temp.21 from 2, r.46 from 5)
q.50 = φ(temp.45 from 2, q.47 from 5)
temp.49 = r.48 < temp.22
conditional_jump temp.49 4 5

---- block 4 ----
jmp 7

---- block 5 ----
temp.51 = r.48 - temp.22
r.46 = temp.51
temp.52 = int 1
temp.53 = q.50 + temp.52
q.47 = temp.53
jmp 3

---- block 7 ----
temp.44 = φ(q.50 from 4)
temp.23 = temp.44
jmp 1

---- block 1 ----
storeprop temp.23, 0
return 

=======================
fn divide(n.1, d.2) -> int

---- block 2 ----
temp.27 = int 0
jmp 0

---- block 0 ----
r.29 = φ(n.1 from 2, r.39 from 5, r.39 from 4)
q.34 = φ(temp.27 from 2, q.43 from 5, q.43 from 4)
temp.33 = r.29 < d.2
conditional_jump temp.33 3 4

---- block 3 ----
return q.34

---- block 4 ----
temp.38 = r.29 - d.2
r.39 = temp.38
temp.41 = int 1
temp.42 = q.34 + temp.41
q.43 = temp.42
jmp 0


----------- remove_unreferenced_functions -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.21 = int 100
getprop temp.22, 0
jmp 2

---- block 2 ----
temp.45 = int 0
jmp 3

---- block 3 ----
r.48 = φ(temp.21 from 2, r.46 from 5)
q.50 = φ(temp.45 from 2, q.47 from 5)
temp.49 = r.48 < temp.22
conditional_jump temp.49 4 5

---- block 4 ----
jmp 7

---- block 5 ----
temp.51 = r.48 - temp.22
r.46 = temp.51
temp.52 = int 1
temp.53 = q.50 + temp.52
q.47 = temp.53
jmp 3

---- block 7 ----
temp.44 = φ(q.50 from 4)
temp.23 = temp.44
jmp 1

---- block 1 ----
storeprop temp.23, 0
return 


----------- empty_phi -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.21 = int 100
getprop temp.22, 0
jmp 2

---- block 2 ----
temp.45 = int 0
jmp 3

---- block 3 ----
r.48 = φ(temp.21 from 2, r.46 from 5)
q.50 = φ(temp.45 from 2, q.47 from 5)
temp.49 = r.48 < temp.22
conditional_jump temp.49 4 5

---- block 4 ----
jmp 7

---- block 5 ----
temp.51 = r.48 - temp.22
r.46 = temp.51
temp.52 = int 1
temp.53 = q.50 + temp.52
q.47 = temp.53
jmp 3

---- block 7 ----
temp.23 = q.50
jmp 1

---- block 1 ----
storeprop temp.23, 0
return 


----------- simplify_blocks -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.21 = int 100
getprop temp.22, 0
temp.45 = int 0
jmp 2

---- block 2 ----
jmp 3

---- block 3 ----
r.48 = φ(temp.21 from 2, r.46 from 5)
q.50 = φ(temp.45 from 2, q.47 from 5)
temp.49 = r.48 < temp.22
conditional_jump temp.49 4 5

---- block 4 ----
temp.23 = q.50
jmp 7

---- block 5 ----
temp.51 = r.48 - temp.22
r.46 = temp.51
temp.52 = int 1
temp.53 = q.50 + temp.52
q.47 = temp.53
jmp 3

---- block 7 ----
storeprop temp.23, 0
jmp 1

---- block 1 ----
return 


----------- copy_propagation -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.21 = int 100
getprop temp.22, 0
temp.45 = int 0
jmp 2

---- block 2 ----
jmp 3

---- block 3 ----
r.48 = φ(temp.21 from 2, r.46 from 5)
q.50 = φ(temp.45 from 2, q.47 from 5)
temp.49 = r.48 < temp.22
conditional_jump temp.49 4 5

---- block 4 ----
temp.23 = q.50
jmp 7

---- block 5 ----
temp.51 = r.48 - temp.22
r.46 = temp.51
temp.52 = int 1
temp.53 = q.50 + temp.52
q.47 = temp.53
jmp 3

---- block 7 ----
storeprop q.50, 0
jmp 1

---- block 1 ----
return 


----------- dead_store_elimination -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.21 = int 100
getprop temp.22, 0
temp.45 = int 0
jmp 2

---- block 2 ----
jmp 3

---- block 3 ----
r.48 = φ(temp.21 from 2, r.46 from 5)
q.50 = φ(temp.45 from 2, q.47 from 5)
temp.49 = r.48 < temp.22
conditional_jump temp.49 4 5

---- block 4 ----
jmp 7

---- block 5 ----
temp.51 = r.48 - temp.22
r.46 = temp.51
temp.52 = int 1
temp.53 = q.50 + temp.52
q.47 = temp.53
jmp 3

---- block 7 ----
storeprop q.50, 0
jmp 1

---- block 1 ----
return 


----------- empty_block -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.21 = int 100
getprop temp.22, 0
temp.45 = int 0
jmp 3

---- block 3 ----
r.48 = φ(temp.21 from 2, r.46 from 5, temp.21 from 0)
q.50 = φ(temp.45 from 2, q.47 from 5, temp.45 from 0)
temp.49 = r.48 < temp.22
conditional_jump temp.49 7 5

---- block 7 ----
storeprop q.50, 0
return 

---- block 5 ----
temp.51 = r.48 - temp.22
r.46 = temp.51
temp.52 = int 1
temp.53 = q.50 + temp.52
q.47 = temp.53
jmp 3


----------- unreferenced_blocks_in_phi -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.21 = int 100
getprop temp.22, 0
temp.45 = int 0
jmp 3

---- block 3 ----
r.48 = φ(r.46 from 5, temp.21 from 0)
q.50 = φ(q.47 from 5, temp.45 from 0)
temp.49 = r.48 < temp.22
conditional_jump temp.49 7 5

---- block 7 ----
storeprop q.50, 0
return 

---- block 5 ----
temp.51 = r.48 - temp.22
r.46 = temp.51
temp.52 = int 1
temp.53 = q.50 + temp.52
q.47 = temp.53
jmp 3
