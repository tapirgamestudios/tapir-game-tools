---
source: crates/tapir-script/compiler/src/compile/ir/optimisations.rs
expression: output
input_file: crates/tapir-script/compiler/src/compile/ir/snapshot_tests/optimisations/integration/division_by_subtraction.tapir
---
----------- before -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.22 = int 100
getprop temp.23, 0
temp.24 = divide(temp.22, temp.23)
temp.25 = temp.24
storeprop temp.25, 0
return 

=======================
fn divide(n.2, d.3) -> int

---- block 2 ----
temp.26 = n.2
r.27 = temp.26
temp.28 = int 0
q.29 = temp.28
jmp 0

---- block 0 ----
r.30 = φ(r.27 from 2, r.40 from 5)
d.32 = φ(d.3 from 2, d.32 from 5)
q.35 = φ(q.29 from 2, q.44 from 5)
temp.31 = r.30
temp.33 = d.32
temp.34 = temp.31 < temp.33
conditional_jump temp.34 3 4

---- block 3 ----
temp.36 = q.35
return temp.36

---- block 4 ----
jmp 5

---- block 5 ----
temp.37 = r.30
temp.38 = d.32
temp.39 = temp.37 - temp.38
r.40 = temp.39
temp.41 = q.35
temp.42 = int 1
temp.43 = temp.41 + temp.42
q.44 = temp.43
jmp 0


----------- empty_phi -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.22 = int 100
getprop temp.23, 0
temp.24 = divide(temp.22, temp.23)
temp.25 = temp.24
storeprop temp.25, 0
return 

=======================
fn divide(n.2, d.3) -> int

---- block 2 ----
temp.26 = n.2
r.27 = temp.26
temp.28 = int 0
q.29 = temp.28
jmp 0

---- block 0 ----
r.30 = φ(r.27 from 2, r.40 from 5)
q.35 = φ(q.29 from 2, q.44 from 5)
temp.31 = r.30
temp.33 = d.3
temp.34 = temp.31 < temp.33
conditional_jump temp.34 3 4

---- block 3 ----
temp.36 = q.35
return temp.36

---- block 4 ----
jmp 5

---- block 5 ----
temp.37 = r.30
temp.38 = d.3
temp.39 = temp.37 - temp.38
r.40 = temp.39
temp.41 = q.35
temp.42 = int 1
temp.43 = temp.41 + temp.42
q.44 = temp.43
jmp 0


----------- simplify_blocks -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.22 = int 100
getprop temp.23, 0
temp.24 = divide(temp.22, temp.23)
temp.25 = temp.24
storeprop temp.25, 0
return 

=======================
fn divide(n.2, d.3) -> int

---- block 2 ----
temp.26 = n.2
r.27 = temp.26
temp.28 = int 0
q.29 = temp.28
jmp 0

---- block 0 ----
r.30 = φ(r.27 from 2, r.40 from 5)
q.35 = φ(q.29 from 2, q.44 from 5)
temp.31 = r.30
temp.33 = d.3
temp.34 = temp.31 < temp.33
conditional_jump temp.34 3 4

---- block 3 ----
temp.36 = q.35
return temp.36

---- block 4 ----
temp.37 = r.30
temp.38 = d.3
temp.39 = temp.37 - temp.38
r.40 = temp.39
temp.41 = q.35
temp.42 = int 1
temp.43 = temp.41 + temp.42
q.44 = temp.43
jmp 5

---- block 5 ----
jmp 0


----------- copy_propagation -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.22 = int 100
getprop temp.23, 0
temp.24 = divide(temp.22, temp.23)
temp.25 = temp.24
storeprop temp.24, 0
return 

=======================
fn divide(n.2, d.3) -> int

---- block 2 ----
temp.26 = n.2
r.27 = n.2
temp.28 = int 0
q.29 = temp.28
jmp 0

---- block 0 ----
r.30 = φ(n.2 from 2, r.40 from 5)
q.35 = φ(temp.28 from 2, q.44 from 5)
temp.31 = r.30
temp.33 = d.3
temp.34 = r.30 < d.3
conditional_jump temp.34 3 4

---- block 3 ----
temp.36 = q.35
return q.35

---- block 4 ----
temp.37 = r.30
temp.38 = d.3
temp.39 = r.30 - d.3
r.40 = temp.39
temp.41 = q.35
temp.42 = int 1
temp.43 = q.35 + temp.42
q.44 = temp.43
jmp 5

---- block 5 ----
jmp 0


----------- dead_store_elimination -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.22 = int 100
getprop temp.23, 0
temp.24 = divide(temp.22, temp.23)
storeprop temp.24, 0
return 

=======================
fn divide(n.2, d.3) -> int

---- block 2 ----
temp.28 = int 0
jmp 0

---- block 0 ----
r.30 = φ(n.2 from 2, r.40 from 5)
q.35 = φ(temp.28 from 2, q.44 from 5)
temp.34 = r.30 < d.3
conditional_jump temp.34 3 4

---- block 3 ----
return q.35

---- block 4 ----
temp.39 = r.30 - d.3
r.40 = temp.39
temp.42 = int 1
temp.43 = q.35 + temp.42
q.44 = temp.43
jmp 5

---- block 5 ----
jmp 0


----------- empty_block -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.22 = int 100
getprop temp.23, 0
temp.24 = divide(temp.22, temp.23)
storeprop temp.24, 0
return 

=======================
fn divide(n.2, d.3) -> int

---- block 2 ----
temp.28 = int 0
jmp 0

---- block 0 ----
r.30 = φ(n.2 from 2, r.40 from 5, r.40 from 4)
q.35 = φ(temp.28 from 2, q.44 from 5, q.44 from 4)
temp.34 = r.30 < d.3
conditional_jump temp.34 3 4

---- block 3 ----
return q.35

---- block 4 ----
temp.39 = r.30 - d.3
r.40 = temp.39
temp.42 = int 1
temp.43 = q.35 + temp.42
q.44 = temp.43
jmp 0


----------- inline_small_functions -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.22 = int 100
getprop temp.23, 0
jmp 2

---- block 2 ----
temp.46 = int 0
jmp 3

---- block 3 ----
r.49 = φ(temp.22 from 2, r.47 from 5)
q.51 = φ(temp.46 from 2, q.48 from 5)
temp.50 = r.49 < temp.23
conditional_jump temp.50 4 5

---- block 4 ----
jmp 7

---- block 5 ----
temp.52 = r.49 - temp.23
r.47 = temp.52
temp.53 = int 1
temp.54 = q.51 + temp.53
q.48 = temp.54
jmp 3

---- block 7 ----
temp.45 = φ(q.51 from 4)
temp.24 = temp.45
jmp 1

---- block 1 ----
storeprop temp.24, 0
return 

=======================
fn divide(n.2, d.3) -> int

---- block 2 ----
temp.28 = int 0
jmp 0

---- block 0 ----
r.30 = φ(n.2 from 2, r.40 from 5, r.40 from 4)
q.35 = φ(temp.28 from 2, q.44 from 5, q.44 from 4)
temp.34 = r.30 < d.3
conditional_jump temp.34 3 4

---- block 3 ----
return q.35

---- block 4 ----
temp.39 = r.30 - d.3
r.40 = temp.39
temp.42 = int 1
temp.43 = q.35 + temp.42
q.44 = temp.43
jmp 0


----------- remove_unreferenced_functions -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.22 = int 100
getprop temp.23, 0
jmp 2

---- block 2 ----
temp.46 = int 0
jmp 3

---- block 3 ----
r.49 = φ(temp.22 from 2, r.47 from 5)
q.51 = φ(temp.46 from 2, q.48 from 5)
temp.50 = r.49 < temp.23
conditional_jump temp.50 4 5

---- block 4 ----
jmp 7

---- block 5 ----
temp.52 = r.49 - temp.23
r.47 = temp.52
temp.53 = int 1
temp.54 = q.51 + temp.53
q.48 = temp.54
jmp 3

---- block 7 ----
temp.45 = φ(q.51 from 4)
temp.24 = temp.45
jmp 1

---- block 1 ----
storeprop temp.24, 0
return 


----------- empty_phi -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.22 = int 100
getprop temp.23, 0
jmp 2

---- block 2 ----
temp.46 = int 0
jmp 3

---- block 3 ----
r.49 = φ(temp.22 from 2, r.47 from 5)
q.51 = φ(temp.46 from 2, q.48 from 5)
temp.50 = r.49 < temp.23
conditional_jump temp.50 4 5

---- block 4 ----
jmp 7

---- block 5 ----
temp.52 = r.49 - temp.23
r.47 = temp.52
temp.53 = int 1
temp.54 = q.51 + temp.53
q.48 = temp.54
jmp 3

---- block 7 ----
temp.24 = q.51
jmp 1

---- block 1 ----
storeprop temp.24, 0
return 


----------- simplify_blocks -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.22 = int 100
getprop temp.23, 0
temp.46 = int 0
jmp 2

---- block 2 ----
jmp 3

---- block 3 ----
r.49 = φ(temp.22 from 2, r.47 from 5)
q.51 = φ(temp.46 from 2, q.48 from 5)
temp.50 = r.49 < temp.23
conditional_jump temp.50 4 5

---- block 4 ----
temp.24 = q.51
jmp 7

---- block 5 ----
temp.52 = r.49 - temp.23
r.47 = temp.52
temp.53 = int 1
temp.54 = q.51 + temp.53
q.48 = temp.54
jmp 3

---- block 7 ----
storeprop temp.24, 0
jmp 1

---- block 1 ----
return 


----------- copy_propagation -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.22 = int 100
getprop temp.23, 0
temp.46 = int 0
jmp 2

---- block 2 ----
jmp 3

---- block 3 ----
r.49 = φ(temp.22 from 2, r.47 from 5)
q.51 = φ(temp.46 from 2, q.48 from 5)
temp.50 = r.49 < temp.23
conditional_jump temp.50 4 5

---- block 4 ----
temp.24 = q.51
jmp 7

---- block 5 ----
temp.52 = r.49 - temp.23
r.47 = temp.52
temp.53 = int 1
temp.54 = q.51 + temp.53
q.48 = temp.54
jmp 3

---- block 7 ----
storeprop q.51, 0
jmp 1

---- block 1 ----
return 


----------- dead_store_elimination -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.22 = int 100
getprop temp.23, 0
temp.46 = int 0
jmp 2

---- block 2 ----
jmp 3

---- block 3 ----
r.49 = φ(temp.22 from 2, r.47 from 5)
q.51 = φ(temp.46 from 2, q.48 from 5)
temp.50 = r.49 < temp.23
conditional_jump temp.50 4 5

---- block 4 ----
jmp 7

---- block 5 ----
temp.52 = r.49 - temp.23
r.47 = temp.52
temp.53 = int 1
temp.54 = q.51 + temp.53
q.48 = temp.54
jmp 3

---- block 7 ----
storeprop q.51, 0
jmp 1

---- block 1 ----
return 


----------- empty_block -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.22 = int 100
getprop temp.23, 0
temp.46 = int 0
jmp 3

---- block 3 ----
r.49 = φ(temp.22 from 2, r.47 from 5, temp.22 from 0)
q.51 = φ(temp.46 from 2, q.48 from 5, temp.46 from 0)
temp.50 = r.49 < temp.23
conditional_jump temp.50 7 5

---- block 7 ----
storeprop q.51, 0
return 

---- block 5 ----
temp.52 = r.49 - temp.23
r.47 = temp.52
temp.53 = int 1
temp.54 = q.51 + temp.53
q.48 = temp.54
jmp 3


----------- unreferenced_blocks_in_phi -------------
=======================
fn @toplevel() -> 

---- block 0 ----
temp.22 = int 100
getprop temp.23, 0
temp.46 = int 0
jmp 3

---- block 3 ----
r.49 = φ(r.47 from 5, temp.22 from 0)
q.51 = φ(q.48 from 5, temp.46 from 0)
temp.50 = r.49 < temp.23
conditional_jump temp.50 7 5

---- block 7 ----
storeprop q.51, 0
return 

---- block 5 ----
temp.52 = r.49 - temp.23
r.47 = temp.52
temp.53 = int 1
temp.54 = q.51 + temp.53
q.48 = temp.54
jmp 3
